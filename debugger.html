<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Typewriter ‚Äî √âter Digital</title>
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=JetBrains+Mono:wght@300&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #2c3e50 0%, #1a1a1a 100%);
            overflow: hidden;
            font-family: 'JetBrains Mono', monospace;
            cursor: none;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 2px solid #e2d1b1;
            border-radius: 50%;
            pointer-events: none;
            z-index: 10000;
            transition: transform 0.1s ease;
            mix-blend-mode: difference;
        }

        .cursor.typing {
            transform: scale(0.7);
            background: rgba(226, 209, 177, 0.3);
        }

        #paper-text {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            padding: 40px 50px;
            font-family: 'Special Elite', monospace;
            font-size: 16px;
            line-height: 2;
            color: #2c3e50;
            white-space: pre-wrap;
            word-wrap: break-word;
            pointer-events: none;
            z-index: 100;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
        }

        #paper-text::after {
            content: '‚ñà';
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            49% {
                opacity: 1;
            }

            50%,
            100% {
                opacity: 0;
            }
        }

        .action-buttons {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 30px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-buttons.show {
            opacity: 1;
        }

        .action-btn {
            background: rgba(226, 209, 177, 0.1);
            border: 2px solid #e2d1b1;
            color: #e2d1b1;
            padding: 15px 35px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .action-btn:hover {
            background: rgba(226, 209, 177, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(226, 209, 177, 0.3);
        }

        .action-btn.save {
            border-color: #4ecca3;
            color: #4ecca3;
        }

        .action-btn.save:hover {
            background: rgba(78, 204, 163, 0.2);
            box-shadow: 0 5px 20px rgba(78, 204, 163, 0.3);
        }

        .action-btn.discard {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .action-btn.discard:hover {
            background: rgba(255, 107, 107, 0.2);
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.3);
        }

        .drawer-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 450px;
            height: 100vh;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            border-left: 2px solid #4ecca3;
            z-index: 2000;
            transition: right 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 30px;
        }

        .drawer-panel.open {
            right: 0;
        }

        .trash-panel {
            position: fixed;
            top: 0;
            left: -500px;
            width: 450px;
            height: 100vh;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            border-right: 2px solid #ff6b6b;
            z-index: 2000;
            transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 30px;
        }

        .trash-panel.open {
            left: 0;
        }

        .panel-header {
            font-size: 24px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(226, 209, 177, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-panel {
            cursor: pointer;
            font-size: 28px;
            color: #e2d1b1;
            transition: color 0.3s ease;
        }

        .close-panel:hover {
            color: #fff;
        }

        .letter-item {
            background: rgba(226, 209, 177, 0.05);
            border: 1px solid rgba(226, 209, 177, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .letter-item:hover {
            background: rgba(226, 209, 177, 0.1);
            border-color: rgba(226, 209, 177, 0.4);
            transform: translateX(5px);
        }

        .letter-date {
            font-size: 11px;
            color: #888;
            margin-bottom: 10px;
        }

        .letter-preview {
            font-family: 'Special Elite', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #e2d1b1;
            max-height: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .letter-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .letter-action-btn {
            flex: 1;
            padding: 8px;
            background: transparent;
            border: 1px solid rgba(226, 209, 177, 0.3);
            color: #e2d1b1;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .letter-action-btn:hover {
            background: rgba(226, 209, 177, 0.1);
        }

        .letter-action-btn.delete {
            border-color: rgba(255, 107, 107, 0.5);
            color: #ff6b6b;
        }

        .letter-action-btn.delete:hover {
            background: rgba(255, 107, 107, 0.1);
        }

        .toggle-panels {
            position: fixed;
            top: 30px;
            left: 30px;
            display: flex;
            gap: 15px;
            z-index: 1500;
        }

        .toggle-btn {
            width: 50px;
            height: 50px;
            background: rgba(226, 209, 177, 0.1);
            border: 2px solid #e2d1b1;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .toggle-btn:hover {
            background: rgba(226, 209, 177, 0.2);
            transform: scale(1.1);
        }

        .toggle-btn.drawer {
            border-color: #4ecca3;
            color: #4ecca3;
        }

        .toggle-btn.trash {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #4ecca3;
            color: #050505;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .badge.trash-badge {
            background: #ff6b6b;
        }

        .back-link {
            position: fixed;
            top: 30px;
            right: 30px;
            color: #e2d1b1;
            text-decoration: none;
            font-size: 12px;
            z-index: 1500;
            padding: 12px 20px;
            border: 2px solid #e2d1b1;
            border-radius: 25px;
            background: rgba(226, 209, 177, 0.05);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .back-link:hover {
            background: rgba(226, 209, 177, 0.15);
            transform: translateY(-2px);
        }

        .instructions {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(226, 209, 177, 0.6);
            font-size: 11px;
            text-align: center;
            z-index: 500;
            pointer-events: none;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: #e2d1b1;
            font-size: 18px;
            letter-spacing: 3px;
            transition: opacity 0.5s ease;
        }

        #loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(226, 209, 177, 0.4);
            font-size: 14px;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
</head>

<body>
    <div id="loading">CARREGANDO M√ÅQUINA...</div>

    <div class="cursor"></div>

    <a href="index.html" class="back-link">‚Üê MENU</a>

    <div class="toggle-panels">
        <div class="toggle-btn drawer" id="toggle-drawer" title="Cartas Salvas">
            üìÅ
            <span class="badge" id="saved-badge">0</span>
        </div>
        <div class="toggle-btn trash" id="toggle-trash" title="Cartas Descartadas">
            üóëÔ∏è
            <span class="badge trash-badge" id="trash-badge">0</span>
        </div>
    </div>

    <div class="drawer-panel" id="drawer">
        <div class="panel-header">
            <span style="color: #4ecca3;">Cartas Salvas</span>
            <span class="close-panel" id="close-drawer">√ó</span>
        </div>
        <div id="saved-letters-list"></div>
    </div>

    <div class="trash-panel" id="trash">
        <div class="panel-header">
            <span style="color: #ff6b6b;">Cartas Descartadas</span>
            <span class="close-panel" id="close-trash">√ó</span>
        </div>
        <div id="trash-letters-list"></div>
    </div>

    <div id="canvas-container"></div>
    <div id="paper-text"></div>

    <div class="action-buttons" id="action-buttons">
        <button class="action-btn save" id="save-btn">üíæ Salvar</button>
        <button class="action-btn discard" id="discard-btn">üóëÔ∏è Descartar</button>
        <button class="action-btn" id="new-btn">üìÑ Nova</button>
    </div>

    <div class="instructions">
        Digite suas reflex√µes ‚Ä¢ As teclas respondem ao seu toque
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        const cursor = document.querySelector('.cursor');
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            cursor.style.left = mouseX - 10 + 'px';
            cursor.style.top = mouseY - 10 + 'px';
        });

        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0x2c3e50, 10, 50);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 12);
        camera.lookAt(0, 2, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        const mainLight = new THREE.DirectionalLight(0xffe4b5, 0.8);
        mainLight.position.set(5, 10, 5);
        mainLight.castShadow = true;
        scene.add(mainLight);

        const fillLight = new THREE.PointLight(0xe2d1b1, 0.3);
        fillLight.position.set(-5, 5, -5);
        scene.add(fillLight);

        const deskGeom = new THREE.BoxGeometry(20, 0.5, 15);
        const deskMat = new THREE.MeshStandardMaterial({
            color: 0x4a3728,
            roughness: 0.8,
            metalness: 0.1
        });
        const desk = new THREE.Mesh(deskGeom, deskMat);
        desk.receiveShadow = true;
        scene.add(desk);

        const typewriterGroup = new THREE.Group();
        typewriterGroup.position.set(0, 0.5, 0);
        scene.add(typewriterGroup);

        const baseGeom = new THREE.BoxGeometry(6, 0.3, 4);
        const baseMat = new THREE.MeshStandardMaterial({
            color: 0x1a1a1a,
            roughness: 0.6,
            metalness: 0.4
        });
        const base = new THREE.Mesh(baseGeom, baseMat);
        base.castShadow = true;
        typewriterGroup.add(base);

        const rollerGeom = new THREE.CylinderGeometry(0.15, 0.15, 5, 16);
        const rollerMat = new THREE.MeshStandardMaterial({
            color: 0x2a2a2a,
            roughness: 0.4,
            metalness: 0.6
        });
        const roller = new THREE.Mesh(rollerGeom, rollerMat);
        roller.rotation.z = Math.PI / 2;
        roller.position.set(0, 0.8, -1.5);
        roller.castShadow = true;
        typewriterGroup.add(roller);

        const paperGeom = new THREE.PlaneGeometry(4, 5);
        const paperMat = new THREE.MeshStandardMaterial({
            color: 0xf5f5dc,
            roughness: 0.9,
            side: THREE.DoubleSide
        });
        const paper = new THREE.Mesh(paperGeom, paperMat);
        paper.position.set(0, 1.5, -1.5);
        paper.rotation.x = -0.1;
        paper.receiveShadow = true;
        typewriterGroup.add(paper);

        const keys = [];
        const keyLayout = [
            ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
            ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
            ['Z', 'X', 'C', 'V', 'B', 'N', 'M']
        ];

        const keyGeom = new THREE.BoxGeometry(0.35, 0.15, 0.35);
        const keyMat = new THREE.MeshStandardMaterial({
            color: 0xe8e8e8,
            roughness: 0.5,
            metalness: 0.2
        });

        keyLayout.forEach((row, rowIndex) => {
            row.forEach((letter, colIndex) => {
                const key = new THREE.Mesh(keyGeom, keyMat.clone());
                const offsetX = (colIndex - row.length / 2) * 0.45;
                const offsetZ = rowIndex * 0.45;
                key.position.set(offsetX, 0.25, 0.5 + offsetZ);
                key.castShadow = true;
                key.userData.letter = letter;
                key.userData.originalY = 0.25;
                typewriterGroup.add(key);
                keys.push(key);
            });
        });

        const spaceGeom = new THREE.BoxGeometry(2.5, 0.15, 0.35);
        const spaceKey = new THREE.Mesh(spaceGeom, keyMat.clone());
        spaceKey.position.set(0, 0.25, 1.85);
        spaceKey.castShadow = true;
        spaceKey.userData.letter = ' ';
        spaceKey.userData.originalY = 0.25;
        typewriterGroup.add(spaceKey);
        keys.push(spaceKey);

        let currentText = '';
        const paperTextEl = document.getElementById('paper-text');
        const actionButtons = document.getElementById('action-buttons');

        let savedLetters = JSON.parse(localStorage.getItem('savedLetters') || '[]');
        let trashedLetters = JSON.parse(localStorage.getItem('trashedLetters') || '[]');

        function updateBadges() {
            document.getElementById('saved-badge').textContent = savedLetters.length;
            document.getElementById('trash-badge').textContent = trashedLetters.length;
        }

        function saveLetter() {
            if (currentText.trim()) {
                savedLetters.unshift({
                    text: currentText,
                    date: new Date().toLocaleString('pt-BR')
                });
                localStorage.setItem('savedLetters', JSON.stringify(savedLetters));
                updateBadges();
                renderSavedLetters();
                clearPaper();

                gsap.to(paper.position, {
                    y: 3,
                    duration: 0.5,
                    ease: 'back.in',
                    onComplete: () => {
                        paper.position.y = 1.5;
                    }
                });
            }
        }

        function discardLetter() {
            if (currentText.trim()) {
                trashedLetters.unshift({
                    text: currentText,
                    date: new Date().toLocaleString('pt-BR')
                });
                localStorage.setItem('trashedLetters', JSON.stringify(trashedLetters));
                updateBadges();
                renderTrashedLetters();
                clearPaper();

                gsap.to(paper.rotation, {
                    x: Math.PI * 2,
                    y: Math.PI,
                    duration: 0.8,
                    ease: 'power2.in',
                    onComplete: () => {
                        paper.rotation.set(-0.1, 0, 0);
                    }
                });
            }
        }

        function clearPaper() {
            currentText = '';
            paperTextEl.textContent = '';
            actionButtons.classList.remove('show');
        }

        document.addEventListener('keydown', (e) => {
            const key = e.key.toUpperCase();

            const keyMesh = keys.find(k => k.userData.letter === key ||
                (key === ' ' && k.userData.letter === ' '));

            if (keyMesh && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();

                if (currentText.length >= 500) return;

                gsap.to(keyMesh.position, {
                    y: keyMesh.userData.originalY - 0.08,
                    duration: 0.05,
                    ease: 'power2.out',
                    onComplete: () => {
                        gsap.to(keyMesh.position, {
                            y: keyMesh.userData.originalY,
                            duration: 0.15,
                            ease: 'elastic.out(1, 0.5)'
                        });
                    }
                });

                if (key === 'BACKSPACE') {
                    currentText = currentText.slice(0, -1);
                } else if (key === 'ENTER') {
                    currentText += '\n';
                } else if (key.length === 1 || key === ' ') {
                    currentText += e.shiftKey ? key : key.toLowerCase();
                }

                paperTextEl.textContent = currentText;

                if (currentText.trim().length > 0) {
                    actionButtons.classList.add('show');
                } else {
                    actionButtons.classList.remove('show');
                }

                cursor.classList.add('typing');
                setTimeout(() => cursor.classList.remove('typing'), 100);
            }
        });

        document.getElementById('save-btn').addEventListener('click', saveLetter);
        document.getElementById('discard-btn').addEventListener('click', discardLetter);
        document.getElementById('new-btn').addEventListener('click', clearPaper);

        const drawer = document.getElementById('drawer');
        const trash = document.getElementById('trash');

        document.getElementById('toggle-drawer').addEventListener('click', () => {
            drawer.classList.toggle('open');
            trash.classList.remove('open');
        });

        document.getElementById('toggle-trash').addEventListener('click', () => {
            trash.classList.toggle('open');
            drawer.classList.remove('open');
        });

        document.getElementById('close-drawer').addEventListener('click', () => {
            drawer.classList.remove('open');
        });

        document.getElementById('close-trash').addEventListener('click', () => {
            trash.classList.remove('open');
        });

        function renderSavedLetters() {
            const container = document.getElementById('saved-letters-list');
            if (savedLetters.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div>Nenhuma carta salva ainda</div>';
                return;
            }

            container.innerHTML = savedLetters.map((letter, index) => `
                <div class="letter-item">
                    <div class="letter-date">${letter.date}</div>
                    <div class="letter-preview">${letter.text}</div>
                    <div class="letter-actions">
                        <button class="letter-action-btn delete" onclick="deleteSaved(${index})">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function renderTrashedLetters() {
            const container = document.getElementById('trash-letters-list');
            if (trashedLetters.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üóëÔ∏è</div>Lixeira vazia</div>';
                return;
            }

            container.innerHTML = trashedLetters.map((letter, index) => `
                <div class="letter-item">
                    <div class="letter-date">${letter.date}</div>
                    <div class="letter-preview">${letter.text}</div>
                    <div class="letter-actions">
                        <button class="letter-action-btn" onclick="restoreLetter(${index})">Restaurar</button>
                        <button class="letter-action-btn delete" onclick="deleteTrash(${index})">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        window.deleteSaved = (index) => {
            savedLetters.splice(index, 1);
            localStorage.setItem('savedLetters', JSON.stringify(savedLetters));
            updateBadges();
            renderSavedLetters();
        };

        window.deleteTrash = (index) => {
            trashedLetters.splice(index, 1);
            localStorage.setItem('trashedLetters', JSON.stringify(trashedLetters));
            updateBadges();
            renderTrashedLetters();
        };

        window.restoreLetter = (index) => {
            const letter = trashedLetters.splice(index, 1)[0];
            savedLetters.unshift(letter);
            localStorage.setItem('savedLetters', JSON.stringify(savedLetters));
            localStorage.setItem('trashedLetters', JSON.stringify(trashedLetters));
            updateBadges();
            renderSavedLetters();
            renderTrashedLetters();
        };

        function animate() {
            typewriterGroup.rotation.y = Math.sin(Date.now() * 0.0003) * 0.02;
            paper.position.y = 1.5 + Math.sin(Date.now() * 0.001) * 0.02;

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        setTimeout(() => {
            document.getElementById('loading').classList.add('hidden');
            updateBadges();
            renderSavedLetters();
            renderTrashedLetters();
            animate();
        }, 1000);
    </script>
</body>

</html>